
<h1>[% quickship ? 'Quick Ship Order' : 'New Order' %]</h1>

<script src="/static/js/customer-order.js"></script>

<form id="frm_order" name="frm_order" method="post" action="/customer/order/[% quickship ? 'quickship' : 'onepage' %]">
	<input type="hidden" id="thirdpartyacctid" name="thirdpartyacctid" value="[% thirdpartyacctid %]"/>
	<input type="hidden" id="coid" name="coid" value="[% coid %]"/>
	<input type="hidden" id="do" name="do" value="save"/>
	[% IF AUTO_PROCESS %]
	<input type="hidden" id="autoprocess" name="autoprocess" value="1"/>
	[% END %]
	[% IF parent %]
	<input type="hidden" name="parent" value="[% parent %]"/>
	[% END %]

	<h2>Address Information</h2>
	[% ADDRESS_SECTION %]

	<h2>Package Detail</h2>
	[% SHIPMENT_SECTION %]

	[% CARRIER_SERVICE_SECTION %]

	<div style="clear: both;">&nbsp;</div>

	<div class="float-left">
		<input type="button" class="orange" value="SPECIAL REQUIREMENTS" onclick="populateSpecialServiceList();"/>
		<div id="special-requirements"></div>
	</div>

	<div class="float-right">
		[% UNLESS CONSOLIDATE %]<input type="button" class="green" id="save" value="SAVE"/>[% END %]
		[% IF quickship %]<input type="button" class="green" id="ship_now" value="SHIP"/>[% END %]
		<input type="button" class="gray" id="cancel" value="CANCEL"/>
	</div>

</form>

<script>

	[% FOREACH item IN requiredfield_list %]
		requiredFieldHash['[% item.name %]']=[% item.details %];
	[% END %]

	$("#tocountry").change(function() {
		checkInternationalSection();
		});

	$("#route").click(function() {
		update_package_product_sequence();
		get_customer_service_list($("#frm_order").serialize());
		});

	$('#save').click(function() {
		delete requiredFieldHash['package-detail-list'];
		$("#frm_order").submit();
		});

	$("#ship_now").click(function() {

		update_package_product_sequence();
		validateForm(requiredFieldHash);

		var carrier     = $("#carrier").val();
		var totalweight = $("#totalweight").val();

		if ($('#autoprocess').val() == 1)
			{
			if (totalweight == undefined || totalweight == 0) return;
			if (carrier == undefined || carrier == '')
				{
				$('#route').click();
				return;
				}
			}

		if (carrier == undefined) return;

		if (carrier.toUpperCase() != 'FEDEX' && carrier.toUpperCase() != 'UPS' && carrier.toUpperCase() != 'USPS')
			{
			showError("Only FedEx/UPS/USPS is supported, please select correct carrier from list.");
			return;
			}

		$("#do").val("ship");
		$("#frm_order").submit();
		});

	$('#cancel').click(function() {
		requiredFieldHash = {};
		$("#do").val("cancel");
		$("#frm_order").submit();
		});

	$("#frm_order").submit(function() {
		update_package_product_sequence();
		return validateForm(requiredFieldHash);
		});

	[% IF tooltips %]
		[% FOREACH item IN tooltips %]$("input[name^='[% item.id %]']").attr('title','[% item.value %]');[% END %]
		setToolTip();
	[% END %]

	$(document).ready(function() {
		calculate_total_packages();
		calculate_total_weight();
		checkInternationalSection();
		$('#carrier-service-list').tabs();
		if(requiredFieldHash) {
			markRequiredFields(requiredFieldHash);
			}

		if ($('#autoprocess').val() == 1) {
			$("#ship_now").click();
			}
		});

</script>